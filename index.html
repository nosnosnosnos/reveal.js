<!doctype html>
<html>

<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">

	<title>reveal.js</title>

	<link rel="stylesheet" href="css/reset.css">
	<link rel="stylesheet" href="css/reveal.css">
	<link rel="stylesheet" href="css/theme/black.css">

	<!-- Theme used for syntax highlighting of code -->
	<link rel="stylesheet" href="lib/css/monokai.css">

	<!-- Printing and PDF exports -->
	<script>
		var link = document.createElement('link');
		link.rel = 'stylesheet';
		link.type = 'text/css';
		link.href = window.location.search.match(/print-pdf/gi) ? 'css/print/pdf.css' : 'css/print/paper.css';
		document.getElementsByTagName('head')[0].appendChild(link);
	</script>
</head>

<body>
	<div class="reveal">
		<div class="slides">

			<!--               1                 -->
			<section data-markdown>
				<textarea data-template>
					## ぷよぷよ風味のゲームAIを作った話
					奥冨 匠
				</textarea>
			</section>

			<!--               2                 -->
			<section data-markdown>
				<textarea data-template>
					ぷよぷよ風味を感じてほしい
					<iframe width="560" height="315" src="https://www.youtube.com/embed/BBEeTwFGJmg" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>
				</textarea>
			</section>

			<!--               3                 -->
			<section data-markdown>
				<textarea data-template>
					目次
					- 連鎖を作る方法
					- 計算量を抑える方法
					- 地道な高速化
					- 勧誘
				</textarea>
			</section>

			<!--               4                 -->
			<section data-markdown>
				<textarea data-template>
					簡単な説明
					- 縦横斜めで和が20になると消える！ぷよぷよ
					- 全部で1000ターンまであり、すべてのターンで落ちてくるぷよは前もって分かります
				</textarea>
			</section>

			<!--               4                 -->
			<section data-markdown>
				<textarea data-template>
					どうやって連鎖させればいいんだろう
					自分もぷよぷよ出来ないのに…

				</textarea>
			</section>

			<!--               4                 -->
			<section data-markdown>
				<textarea data-template>
					#### 全部で1000ターンまであり、落ちてくるぷよは全て事前に分かります
				　　
					 総当たりでシミュレートすればいいのでは！
				</textarea>
			</section>

			<section data-markdown>
				<textarea data-template>
					2手先までの図
					<img data-src="tree.png">
				</textarea>
			</section>

			<section data-markdown>
				<textarea data-template>
					木構造といえば探索
					<img data-src="tree.png">
				</textarea>
			</section>

			<section data-markdown>
				<textarea data-template>
					探索アルゴリズム一覧
					- 幅優先探索
					- 深さ優先探索
					- ビームサーチ
					- chokudaiサーチ
				</textarea>
			</section>

			<section data-markdown>
				<textarea data-template>
					でも問題が!
					盤面数が多すぎて時間がかかる！
				</textarea>
			</section>

			<section data-markdown>
				<textarea data-template>
						<img data-src="tree.png">
						1ターンに約40通りの落とし方があります
				</textarea>
			</section>

			<section data-markdown>
				<textarea data-template>
						n手先まで全部見ると、40^n通りあります!!
						<img data-src="https://3.bp.blogspot.com/-BKAMRiYwJMU/VvIUB-eJ9lI/AAAAAAAA5DM/ls1IM5oJyP8z9h-zPdfVuoGDDistAGdUA/s400/jiko_rakka.png">
				</textarea>
			</section>

			<section data-markdown>
				<textarea data-template>
						n手先まで全部見ると、40のn乗通りあります!!
						全部見られない
				</textarea>
			</section>

			<section data-markdown>
				<textarea data-template>
						枝刈りしよう！
						<img data-src="https://4.bp.blogspot.com/-kAPATIKR69U/WlGnzyJ0uVI/AAAAAAABJeY/CtXicJVz3C0eShdqptLPYar-Bnu7jY9yACLcBGAs/s800/gardening_takaeda_kiribasami.png">
				</textarea>
			</section>

			<section data-markdown>
				<textarea data-template>
					<img data-src="tree.png">
				</textarea>
			</section>

			<section data-markdown>
				<textarea data-template>
						<img data-src="https://4.bp.blogspot.com/-kAPATIKR69U/WlGnzyJ0uVI/AAAAAAABJeY/CtXicJVz3C0eShdqptLPYar-Bnu7jY9yACLcBGAs/s800/gardening_takaeda_kiribasami.png">
				</textarea>
			</section>

			<section data-markdown>
				<textarea data-template>
						連鎖しなさそうな状態になったら、その枝を打ち切る
						例
						- 中途半端に連鎖してしまった
						- 天井にぶつかりそう
				</textarea>
			</section>

			<section data-markdown>
				<textarea data-template>
						~~~連鎖しなさそうな状態になったら、その枝を打ち切る~~~
						40本も枝があるので、むしろ優秀なのを選ぶ!
						<img data-src="https://2.bp.blogspot.com/-nJHp8vLIrEo/Wat3BxiPZTI/AAAAAAABGdY/awyKq7pb8LE9Q2VN5WygN1ygS9fHenj0ACLcBGAs/s800/tsuri_zarigani.png">
				</textarea>
			</section>


			<section data-markdown>
				<textarea data-template>
						どうやって連鎖しそう度を数値にする？
						<img data-src="https://1.bp.blogspot.com/-eMLID2dYzwM/VwIgW_nlilI/AAAAAAAA5bY/-osLYuNceb4GArB0E5Cl1D4oYMVDNVKIw/s800/question_head_boy.png">
				</textarea>
			</section>

			<section data-markdown>
				<textarea data-template>
					評価関数の中でさらにシミュレータする
					適当にぷよを落として、連鎖した数を評価した
				</textarea>
			</section>

			<section data-markdown>
				<textarea data-template>
					これでうまくぷよを積んでくれるので、好きなタイミングで発火！
					<iframe width="560" height="315" src="https://www.youtube.com/embed/8LHZSFz4rSc" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>
				</textarea>
			</section>

			<section data-markdown>
				<textarea data-template>
					番外編
					とはいえ大会中 他の人も同じことをやっているので僅差勝負
				</textarea>
			</section>

			<section data-markdown>
				<textarea data-template>
					番外編
					人より深く読みたい!!!
					何手先までよめるのか!
					※羽生さんは1000手先までよめるらしい
				</textarea>
			</section>

			<section data-markdown>
				<textarea data-template>
					まず、一回探索した盤面をスキップする -> 効率化
				</textarea>
			</section>

			<section data-markdown>
				<textarea data-template>
					盤面をhash化して、処理済みの盤面と比較
				</textarea>
			</section>

			<section data-markdown>
				<textarea data-template>
					盤面をhash化?
					ZobristHash -> 最強
					どんなゲームにも使える！早い！
				</textarea>
			</section>

			<section data-markdown>
				<textarea data-template>
					すべてのマスのぷよの状態に乱数を割り振る
					<img data-src="puyo.png">
				</textarea>
			</section>

			<section data-markdown>
				<textarea data-template>
					各マスの乱数をそれぞれxor
					hash完成!
					<img data-src="puyo.png">
				</textarea>
			</section>

			<section data-markdown>
				<textarea data-template>
					過去のhashと比べるの、O(N)かかってしまう
					※シミュレートした過去の盤面数をN
				</textarea>
			</section>

			<section data-markdown>
				<textarea data-template>
					weakhash! O(1)でチェック出来る!!!!!!
				</textarea>
			</section>

			<section data-markdown>
				<textarea data-template>
					16bitのhashを作成し、
					8bit,8bitのkey,valueに分ける
				</textarea>
			</section>

			<section data-markdown>
				<textarea data-template>
					16bitのhashを作成し、
					8bit,8bitのkey,valueに分ける

					b1111222233334444 -> b11112222 : b33334444
				</textarea>
			</section>

			<section data-markdown>
				<textarea data-template>
					b1111222233334444 -> b11112222 : b33334444
					```
					int hashList[0xffff];

					if ( hashList[b11112222] == b33334444) {
						//シミュレートしたことある盤面だよ!
					}

					//Listにセット
					hashList[b11112222] = b33334444
					```
				</textarea>
			</section>

			<section data-markdown>
				<textarea data-template>
					他にも空雑巾を絞るような高速化があります
					盤面をbitとして管理する方法や、
					IntelのCPU命令セットならSSE命令を直接叩く
					(ビットが立っている数を高速で数えるSSE命令:popcnt)
				</textarea>
			</section>

			<section data-markdown>
				<textarea data-template>
					呪文みたいなコードだらけですが、意味が分かると面白いです！
					ぜひぜひゲームAIコンテストへ！
					[Coding Games and Programming Challenges to Code Better](https://www.codingame.com/)
				</textarea>
			</section>


		</div>
	</div>

	<script src="js/reveal.js"></script>

	<script>
		// More info about config & dependencies:
		// - https://github.com/hakimel/reveal.js#configuration
		// - https://github.com/hakimel/reveal.js#dependencies
		Reveal.initialize({
			dependencies: [{
					src: 'plugin/markdown/marked.js'
				},
				{
					src: 'plugin/markdown/markdown.js'
				},
				{
					src: 'plugin/notes/notes.js',
					async: true
				},
				{
					src: 'plugin/highlight/highlight.js',
					async: true
				}
			]
		});
	</script>
</body>

</html>
